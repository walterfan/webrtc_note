

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>WebRTC Data Channel &mdash; webrtc_tutorial 1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="WebRTC RTP Header extension" href="rtp_header_extension.html" />
    <link rel="prev" title="WebRTC RTP" href="webrtc_rtp.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> webrtc_tutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1.basic/index.html">1. WebRTC 基础</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. WebRTC 传输</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">WebRTC 传输概论</a></li>
<li class="toctree-l2"><a class="reference internal" href="websocket.html">WebSocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="turn.html">TURN</a></li>
<li class="toctree-l2"><a class="reference internal" href="ice.html">Interactive Connectivity Establishment</a></li>
<li class="toctree-l2"><a class="reference internal" href="quic.html">QUIC 协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="hls.html">HTTP Live Streaming</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_multiplex.html">WebRTC 传输的多路复用</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_transmission.html">WebRTC Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_rtp.html">WebRTC RTP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">WebRTC Data Channel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-channel-establishment-protocol">Data Channel Establishment Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-channel-open-message">DATA_CHANNEL_OPEN Message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">示例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sctp">SCTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">基于消息的多流协议</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id5">参考资料</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rtp_header_extension.html">WebRTC RTP Header extension</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../3.media/index.html">3. WebRTC 媒体</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4.practice/index.html">4. WebRTC 实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.code/index.html">5. WebRTC 源码分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6.tool/index.html">5. WebRTC 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7.misc/index.html">6. WebRTC 关联技术</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">webrtc_tutorial</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">2. WebRTC 传输</a> &raquo;</li>
        
      <li>WebRTC Data Channel</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/2.transport/webrtc_data_channel.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="webrtc-data-channel">
<h1>WebRTC Data Channel<a class="headerlink" href="#webrtc-data-channel" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Abstract</strong></p></td>
<td><p>SCTP protocol</p></td>
</tr>
<tr class="row-even"><td><p><strong>Authors</strong></p></td>
<td><p>Walter Fan</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Status</strong></p></td>
<td><p>WIP as draft</p></td>
</tr>
<tr class="row-even"><td><p><strong>Updated</strong></p></td>
<td><p>2022-04-21</p></td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#id2" id="id6">简介</a></p></li>
<li><p><a class="reference internal" href="#data-channel-establishment-protocol" id="id7">Data Channel Establishment Protocol</a></p>
<ul>
<li><p><a class="reference internal" href="#data-channel-open-message" id="id8">DATA_CHANNEL_OPEN Message</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id9">示例</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#sctp" id="id10">SCTP</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id11">基于消息的多流协议</a></p>
<ul>
<li><p><a class="reference internal" href="#example" id="id12">example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id5" id="id13">参考资料</a></p></li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id6">简介</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>WebRTC 的 Data Channel 被设计用来在两个端点之间传输非音视频之类的媒体流外的数据，例如文本数据，控制命令。
这样无需经过由服务器的信令通道中转，效率较高。当然，通过服务器中转也没问题。</p>
<p>RTCDataChannel 接口表示一个网络通道，可用于任意数据的双向对等传输。 每个数据通道都与一个 RTCPeerConnection 相关联，每个对等连接理论上最多可以有 65,534 个数据通道（实际限制可能因浏览器而异）。</p>
<p>发起方如果要创建数据通道并要求远程对等方加入您，可调用 <cite>RTCPeerConnection 的 createDataChannel()</cite> 方法。
应答方会接收到一个数据通道事件（其类型为 RTCDataChannelEvent），以告知其数据通道已添加到连接中。</p>
<p>Non-media data is handled by using the Stream Control Transmission Protocol (SCTP) <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4960">RFC4960</a> encapsulated in DTLS.
DTLS 1.0 is defined in <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4347">RFC4347</a>; the present latest version,  DTLS 1.2, is defined in <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc6347">RFC6347</a>;
and an upcoming version, DTLS 1.3, is defined in <a class="reference external" href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-dtls13-43">DTLS1.3</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="o">+----------+</span>
        <span class="o">|</span>   <span class="n">SCTP</span>   <span class="o">|</span>
        <span class="o">+----------+</span>
        <span class="o">|</span>   <span class="n">DTLS</span>   <span class="o">|</span>
        <span class="o">+----------+</span>
        <span class="o">|</span> <span class="n">ICE</span><span class="o">/</span><span class="n">UDP</span>  <span class="o">|</span>
        <span class="o">+----------+</span>

<span class="n">Figure</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">Stack</span> <span class="n">Diagram</span>
</pre></div>
</div>
</div>
<div class="section" id="data-channel-establishment-protocol">
<h2><a class="toc-backref" href="#id7">Data Channel Establishment Protocol</a><a class="headerlink" href="#data-channel-establishment-protocol" title="Permalink to this headline">¶</a></h2>
<p>The Data Channel Establishment Protocol is a simple, low-overhead way to establish bidirectional data channels over an SCTP association with a consistent set of properties.</p>
<p>The set of consistent properties includes:</p>
<ul class="simple">
<li><p>reliable or unreliable message transmission.
In case of unreliable transmissions, the same level of unreliability is used.</p></li>
<li><p>in-order or out-of-order message delivery.</p></li>
<li><p>the priority of the data channel.</p></li>
<li><p>an optional label for the data channel.</p></li>
<li><p>an optional protocol for the data channel.</p></li>
<li><p>the streams.</p></li>
</ul>
<div class="section" id="data-channel-open-message">
<h3><a class="toc-backref" href="#id8">DATA_CHANNEL_OPEN Message</a><a class="headerlink" href="#data-channel-open-message" title="Permalink to this headline">¶</a></h3>
<p>This message is initially sent using the data channel on the stream used for user messages.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>  <span class="n">Message</span> <span class="n">Type</span> <span class="o">|</span>  <span class="n">Channel</span> <span class="n">Type</span> <span class="o">|</span>            <span class="n">Priority</span>           <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                    <span class="n">Reliability</span> <span class="n">Parameter</span>                      <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>         <span class="n">Label</span> <span class="n">Length</span>          <span class="o">|</span>       <span class="n">Protocol</span> <span class="n">Length</span>         <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
\                                                               <span class="o">/</span>
<span class="o">|</span>                             <span class="n">Label</span>                             <span class="o">|</span>
<span class="o">/</span>                                                               \
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
\                                                               <span class="o">/</span>
<span class="o">|</span>                            <span class="n">Protocol</span>                           <span class="o">|</span>
<span class="o">/</span>                                                               \
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<ul>
<li><p>Message Type: 1 byte (unsigned integer)</p>
<p>This field holds the IANA-defined message type for the DATA_CHANNEL_OPEN message.
The value of this field is 0x03, as specified in Section 8.2.1 of <a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8832">RFC8832</a></p>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+===================+===========+===========+</span>
<span class="o">|</span> <span class="n">Name</span>              <span class="o">|</span> <span class="n">Type</span>      <span class="o">|</span> <span class="n">Reference</span> <span class="o">|</span>
<span class="o">+===================+===========+===========+</span>
<span class="o">|</span> <span class="n">Reserved</span>          <span class="o">|</span> <span class="mh">0x00</span>      <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+-------------------+-----------+-----------+</span>
<span class="o">|</span> <span class="n">Reserved</span>          <span class="o">|</span> <span class="mh">0x01</span>      <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+-------------------+-----------+-----------+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_ACK</span>  <span class="o">|</span> <span class="mh">0x02</span>      <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+-------------------+-----------+-----------+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_OPEN</span> <span class="o">|</span> <span class="mh">0x03</span>      <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+-------------------+-----------+-----------+</span>
<span class="o">|</span> <span class="n">Unassigned</span>        <span class="o">|</span> <span class="mh">0x04</span><span class="o">-</span><span class="mh">0xfe</span> <span class="o">|</span>           <span class="o">|</span>
<span class="o">+-------------------+-----------+-----------+</span>
<span class="o">|</span> <span class="n">Reserved</span>          <span class="o">|</span> <span class="mh">0xff</span>      <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+-------------------+-----------+-----------+</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Channel Type: 1 byte (unsigned integer)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+================================================+======+===========+</span>
<span class="o">|</span> <span class="n">Name</span>                                           <span class="o">|</span> <span class="n">Type</span> <span class="o">|</span> <span class="n">Reference</span> <span class="o">|</span>
<span class="o">+================================================+======+===========+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_RELIABLE</span>                          <span class="o">|</span> <span class="mh">0x00</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_RELIABLE_UNORDERED</span>                <span class="o">|</span> <span class="mh">0x80</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT</span>           <span class="o">|</span> <span class="mh">0x01</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_PARTIAL_RELIABLE_REXMIT_UNORDERED</span> <span class="o">|</span> <span class="mh">0x81</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_PARTIAL_RELIABLE_TIMED</span>            <span class="o">|</span> <span class="mh">0x02</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">DATA_CHANNEL_PARTIAL_RELIABLE_TIMED_UNORDERED</span>  <span class="o">|</span> <span class="mh">0x82</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">Reserved</span>                                       <span class="o">|</span> <span class="mh">0x7f</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">Reserved</span>                                       <span class="o">|</span> <span class="mh">0xff</span> <span class="o">|</span> <span class="n">RFC</span> <span class="mi">8832</span>  <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
<span class="o">|</span> <span class="n">Unassigned</span>                                     <span class="o">|</span> <span class="n">rest</span> <span class="o">|</span>           <span class="o">|</span>
<span class="o">+------------------------------------------------+------+-----------+</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id9">示例</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Offerer side</span>
<span class="kd">var</span> <span class="nx">pc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCPeerConnection</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="nx">pc</span><span class="p">.</span><span class="nx">createDataChannel</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">);</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hi you!&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Answerer side</span>
<span class="kd">var</span> <span class="nx">pc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCPeerConnection</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="nx">pc</span><span class="p">.</span><span class="nx">ondatachannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">channel</span><span class="p">;</span>
    <span class="nx">channel</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hi back!&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">channel</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="c1">//Alternatively, more symmetrical out-of-band negotiation can be used, using an agreed-upon id (0 here):</span>

<span class="c1">// Both sides</span>

<span class="kd">var</span> <span class="nx">pc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCPeerConnection</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="nx">pc</span><span class="p">.</span><span class="nx">createDataChannel</span><span class="p">(</span><span class="s2">&quot;chat&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">negotiated</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="mf">0</span><span class="p">});</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Hi!&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sctp">
<h2><a class="toc-backref" href="#id10">SCTP</a><a class="headerlink" href="#sctp" title="Permalink to this headline">¶</a></h2>
<p>Data Channel 背后使用的协议是 SCTP</p>
<p>数据通信通过 TCP/TLS 就足够了， 为什么还要 SCTP, 可能是因为 TCP 是面向流的，始终有序和可靠的传输，而我们还想要一种面向消息的，并且可以控制优先级和可靠性的连接， 乱序或者有点丢失也能接受。</p>
<p>SCTP 是基于 DTLS 之上的， 面向消息的， 支持多流，优先级及可靠性可控的连接协议。</p>
<p>假设我们通过一个连接传送流媒体以及控制命令，如果通过 TCP , 包丢失了就要重传，乱序了也一样。SCTP 就可以不一样，流媒体的包可以丢失，控制命令的包不能丢失</p>
<p>它为用户提供以下服务：</p>
<ul class="simple">
<li><p>确认用户数据的无错误非重复传输，</p></li>
<li><p>数据分段以符合发现的路径 MTU 大小，</p></li>
<li><p>在多个流中按顺序传递用户消息，使用单个用户的到达顺序交付选项消息，</p></li>
<li><p>可选地将多个用户消息捆绑到单个 SCTP 数据包，和</p></li>
<li><p>通过支持多宿主实现网络级容错在关联的一端或两端。</p></li>
</ul>
<p>SCTP 的设计包括适当的拥塞避免行为以及对洪水和伪装攻击的抵抗力。</p>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id11">基于消息的多流协议</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>SCTP applications submit data for transmission in messages (groups of bytes) to the SCTP transport layer. SCTP places messages and control information into separate chunks (data chunks and control chunks), each identified by a chunk header.</p>
<p>The protocol can fragment a message into multiple data chunks, but each data chunk contains data from only one user message. SCTP bundles the chunks into SCTP packets. The SCTP packet, which is submitted to the Internet Protocol, consists of a packet header, SCTP control chunks (when necessary), followed by SCTP data chunks (when available).</p>
<div class="section" id="example">
<h3><a class="toc-backref" href="#id12">example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>A simple example based on <a class="reference external" href="https://github.com/P1sec/pysctp">https://github.com/P1sec/pysctp</a></p>
<ul class="simple">
<li><p>server</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sctp</span>

<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;192.168.1.10&#39;</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">12345</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">sctp</span><span class="o">.</span><span class="n">sctpsocket_tcp</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
<span class="n">sock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># wait for a connection</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;waiting for a connection&#39;</span><span class="p">)</span>
    <span class="n">connection</span><span class="p">,</span> <span class="n">client_address</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># show who connected to us</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;connection from&#39;</span><span class="p">,</span> <span class="n">client_address</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">connection</span>
        <span class="c1"># receive the data in small chunks and print it</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">999</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="c1"># output received data</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Data: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;Got &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;, I&#39;m fine, thank you. And you?&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># no more data -- quit the loop</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;no more data.&quot;</span><span class="p">)</span>
                <span class="k">break</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Clean up the connection</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>client</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sctp</span>

<span class="n">sk</span> <span class="o">=</span> <span class="n">sctp</span><span class="o">.</span><span class="n">sctpsocket_tcp</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">)</span>
<span class="n">sk</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;192.168.1.10&quot;</span><span class="p">,</span> <span class="mi">12345</span><span class="p">))</span>

<span class="n">sk</span><span class="o">.</span><span class="n">sctp_send</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;how are you&#39;</span><span class="p">)</span>
<span class="n">sk</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="n">sk</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id13">参考资料</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc4960">RFC4960</a> : Stream Control Transmission Protocol</p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc6525">RFC6525</a> : Stream Control Transmission Protocol (SCTP) Stream Reconfiguration</p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8831">RFC8831</a> : WebRTC Data Channels</p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8832">RFC8832</a> : WebRTC Data Channel Establishment Protocol</p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8260">RFC8260</a> : Stream Schedulers and User Message Interleaving for the Stream Control Transmission Protocol</p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8261">RFC8261</a> : Datagram Transport Layer Security (DTLS) Encapsulation of SCTP Packets</p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc3758">RFC3758</a> : Stream Control Transmission Protocol (SCTP) Partial Reliability Extension</p></li>
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc7496">RFC7496</a> : Additional Policies for the Partially Reliable Stream Control Transmission Protocol Extension</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="rtp_header_extension.html" class="btn btn-neutral float-right" title="WebRTC RTP Header extension" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="webrtc_rtp.html" class="btn btn-neutral float-left" title="WebRTC RTP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Walter Fan, Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>