<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebRTC RED &mdash; webrtc_tutorial 1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Temporal scalability" href="webrtc_temporal_scalability.html" />
    <link rel="prev" title="WebRTC E2E Delay" href="webrtc_e2e_delay.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> webrtc_tutorial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../0.tutorial/index.html">0. WebRTC 简明教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1.basic/index.html">1. WebRTC 基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2.transport/index.html">2. WebRTC 传输</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. WebRTC 媒体</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">WebRTC 媒体概论</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_audio.html">WebRTC 音频</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_video.html">WebRTC 视频</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_qos.html">WebRTC QoS</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_cc.html">WebRTC 拥塞控制</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_fec.html">WebRTC FEC</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_rtx.html">WebRTC RTX</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">WebRTC RED</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">SDP 扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="#packet">Packet 数据包格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reference">Reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_temporal_scalability.html">Temporal scalability</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_feedback.html">WebRTC Feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="jitter_buffer.html">Jitter Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="insertable_stream.html">Insertable Stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_codec.html">Web Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="web_transport.html">Web Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_svc.html">WebRTC SVC</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_metrics.html">WebRTC Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_e2e_delay.html">WebRTC E2E Delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="webrtc_simulcast.html">WebRTC Simulcast</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../4.practice/index.html">4. WebRTC 实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5.code/index.html">5. WebRTC 源码分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6.tool/index.html">5. WebRTC 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7.misc/index.html">6. WebRTC 关联技术</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">webrtc_tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">3. WebRTC 媒体</a> &raquo;</li>
      <li>WebRTC RED</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/3.media/webrtc_red.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="webrtc-red">
<h1>WebRTC RED<a class="headerlink" href="#webrtc-red" title="Permalink to this headline">¶</a></h1>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Abstract</strong></p></td>
<td><p>WebRTC RED</p></td>
</tr>
<tr class="row-even"><td><p><strong>Authors</strong></p></td>
<td><p>Walter Fan</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Status</strong></p></td>
<td><p>WIP</p></td>
</tr>
<tr class="row-even"><td><p><strong>Updated</strong></p></td>
<td><p>2023-06-16</p></td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#id3" id="id5">简介</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id6">SDP 扩展</a></p></li>
<li><p><a class="reference internal" href="#packet" id="id7">Packet 数据包格式</a></p></li>
<li><p><a class="reference internal" href="#reference" id="id8">Reference</a></p></li>
</ul>
</div>
<section id="id3">
<h2><a class="toc-backref" href="#id5">简介</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>RED 即 REDundant coding 冗余编码， 它是一种 RTP 荷载格式，在 RFC 2198 中定义，用于音视频数据的冗余编码. 最早它是用来</p>
<p>The primary motivation of sending redundant data is to be able to recover packets lost under lossy network conditions.</p>
<p>If a packet is lost then the missing information may be reconstructed at the receiver from the redundant data that arrives in the following packet(s).</p>
<p>The use of RED is negotiated in the SDP as an additional payload type and when used the audio/video RTP packets are packaged using RED format with a 6 bytes header, before the primary and secondary payloads conveying the actual audio/video packet and the redundant information.</p>
<p>RED was standardized more than 20 years ago in RFC 2198, and was initially conceived as a simple RTP payload format to implement Redundant Audio Data. Since then, due to its simplicity and flexibility it ended up being used for way more than just audio: we mentioned text streams already, but it’s also used in the Chrome ulpfec implementation for video, for instance. That said, audio is what it was born for, and so it made sense to see if it could still be of help in the WebRTC ecosystem as well.</p>
<p>As a format, it’s quite trivial: it basically allows you to packetize, within the payload of a single RTP packet, multiple frames that you’d normally send in different RTP packets instead. It performs that by listing a series of block headers at the beginning, each containing some relevant information (including the block length), which are then followed by the actual frame payloads in sequence. The following diagram from the RFC shows this more clearly in a visual way:</p>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id6">SDP 扩展</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">=</span><span class="n">audio</span> <span class="mi">12345</span> <span class="n">RTP</span><span class="o">/</span><span class="n">AVP</span> <span class="mi">121</span> <span class="mi">0</span> <span class="mi">5</span>
<span class="n">a</span><span class="o">=</span><span class="n">rtpmap</span><span class="p">:</span><span class="mi">121</span> <span class="n">red</span><span class="o">/</span><span class="mi">8000</span><span class="o">/</span><span class="mi">1</span>
<span class="n">a</span><span class="o">=</span><span class="n">fmtp</span><span class="p">:</span><span class="mi">121</span> <span class="mi">0</span><span class="o">/</span><span class="mi">5</span>
</pre></div>
</div>
</section>
<section id="packet">
<h2><a class="toc-backref" href="#id7">Packet 数据包格式</a><a class="headerlink" href="#packet" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                    <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>  <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span><span class="n">F</span><span class="o">|</span>   <span class="n">block</span> <span class="n">PT</span>  <span class="o">|</span>  <span class="n">timestamp</span> <span class="n">offset</span>         <span class="o">|</span>   <span class="n">block</span> <span class="n">length</span>    <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<ul class="simple">
<li><p>F： （1 bits），之后是否还有其他 RED Header</p>
<ul>
<li><p>1: 之后还有其他RED Header，</p></li>
<li><p>0: 最后一个RED Header</p></li>
</ul>
</li>
<li><p>block PT：7 bits长度，表示该RED Header对应的冗余编码类型</p></li>
<li><p>timeoffset： 14 bits长度，表示无符号长度时间戳偏移，该偏移是相对于RTP Header的时间戳。用无符号长度做偏移意味着冗余编码数据必须在发送完原始数据后才能发送</p></li>
<li><p>block length: 10 bits长度，表示该RED Header对应编码数据块长度，该长度包含RED Header字段</p></li>
</ul>
<p>对于RTP包中最后一个RED Header，可以忽略block length以及timestamp。因为它们可以从RTP Fixed Header以及整个RTP包长度计算得到。最后一个RED Header结构如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span>
<span class="o">+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span><span class="mi">0</span><span class="o">|</span>   <span class="n">Block</span> <span class="n">PT</span>  <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<ul class="simple">
<li><p>example</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                    <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>  <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span><span class="n">V</span><span class="o">=</span><span class="mi">2</span><span class="o">|</span><span class="n">P</span><span class="o">|</span><span class="n">X</span><span class="o">|</span> <span class="n">CC</span><span class="o">=</span><span class="mi">0</span>  <span class="o">|</span><span class="n">M</span><span class="o">|</span>      <span class="n">PT</span>     <span class="o">|</span>   <span class="n">sequence</span> <span class="n">number</span> <span class="n">of</span> <span class="n">primary</span>  <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>              <span class="n">timestamp</span>  <span class="n">of</span> <span class="n">primary</span> <span class="n">encoding</span>                   <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>           <span class="n">synchronization</span> <span class="n">source</span> <span class="p">(</span><span class="n">SSRC</span><span class="p">)</span> <span class="n">identifier</span>            <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span><span class="mi">1</span><span class="o">|</span> <span class="n">block</span> <span class="n">PT</span><span class="o">=</span><span class="mi">7</span>  <span class="o">|</span>  <span class="n">timestamp</span> <span class="n">offset</span>         <span class="o">|</span>   <span class="n">block</span> <span class="n">length</span>    <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span><span class="mi">0</span><span class="o">|</span> <span class="n">block</span> <span class="n">PT</span><span class="o">=</span><span class="mi">5</span>  <span class="o">|</span>                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+</span>                                               <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                <span class="n">LPC</span> <span class="n">encoded</span> <span class="n">redundant</span> <span class="n">data</span> <span class="p">(</span><span class="n">PT</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>              <span class="o">+</span>
<span class="o">|</span>                <span class="p">(</span><span class="mi">14</span> <span class="nb">bytes</span><span class="p">)</span>                                     <span class="o">|</span>
<span class="o">+</span>                                               <span class="o">+---------------+</span>
<span class="o">|</span>                                               <span class="o">|</span>               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>               <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                                                               <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                                                               <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                                                               <span class="o">+</span>
<span class="o">|</span>                <span class="n">DVI4</span> <span class="n">encoded</span> <span class="n">primary</span> <span class="n">data</span> <span class="p">(</span><span class="n">PT</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>               <span class="o">|</span>
<span class="o">+</span>                <span class="p">(</span><span class="mi">84</span> <span class="nb">bytes</span><span class="p">,</span> <span class="ow">not</span> <span class="n">to</span> <span class="n">scale</span><span class="p">)</span>                       <span class="o">+</span>
<span class="o">/</span>                                                               <span class="o">/</span>
<span class="o">+</span>                                                               <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                                                               <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                                               <span class="o">+---------------+</span>
<span class="o">|</span>                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
</section>
<section id="reference">
<h2><a class="toc-backref" href="#id8">Reference</a><a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc2198">https://datatracker.ietf.org/doc/html/rfc2198</a></p></li>
<li><p><a class="reference external" href="https://blog.jianchihu.net/webrtc-research-redundant-rtp-payload-fec.html">https://blog.jianchihu.net/webrtc-research-redundant-rtp-payload-fec.html</a></p></li>
<li><p><a class="reference external" href="https://www.meetecho.com/blog/opus-red/">https://www.meetecho.com/blog/opus-red/</a></p></li>
<li><p><a class="reference external" href="https://webrtchacks.com/red-improving-audio-quality-with-redundancy/">https://webrtchacks.com/red-improving-audio-quality-with-redundancy/</a></p></li>
<li><p><a class="reference external" href="https://webrtc.github.io/samples/src/content/peerconnection/audio/">https://webrtc.github.io/samples/src/content/peerconnection/audio/</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="webrtc_e2e_delay.html" class="btn btn-neutral float-left" title="WebRTC E2E Delay" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="webrtc_temporal_scalability.html" class="btn btn-neutral float-right" title="Temporal scalability" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Walter Fan, Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>